
#ifndef MASTER_TICTACTOE_H
#define MASTER_TICTACTOE_H

#include <utility>
#include <cassert>
#include <map>

#include "../Game.h"
#include "../../utils/HelperMethods.h"
#include "../../utils/SharedDefinitions.h"


class TicTacToe : public Game {
public:
    GameEval moveWhite(int actionCode);
    GameEval moveBlack(int actionCode);

    GameEval reset() override;
    GameEval doAction(int i) override;

    std::vector<float> getInitialState() override;
    virtual std::vector<float> getState();

    [[nodiscard]] int getStateSize() const override { return TIC_TAC_TOE_STATE_SIZE; }

    [[nodiscard]] int getActionSize() const override { return TIC_TAC_TOE_ACTION_SIZE; };

    GameEval doBestAction(const std::vector<std::pair<int, float>> &actionsVec);

private:
    short counter{0};
    bool isWhiteMoving{true};
    short whiteState{0};
    short blackState{0};
    constexpr const static int winCombinations[8] = {
            // each row
            0b000000111,
            0b000111000,
            0b111000000,
            // each column
            0b100100100,
            0b010010010,
            0b001001001,
            // each diagonal
            0b100010001,
            0b001010100
    };
    constexpr const static int actions[TIC_TAC_TOE_ACTION_SIZE] = {
            0b100000000,
            0b010000000,
            0b001000000,
            0b000100000,
            0b000010000,
            0b000001000,
            0b000000100,
            0b000000010,
            0b000000001,
    };

//   1, 0, 1
//   1, 0, 0
//   0, 0, 0
//    constexpr const static int forkCombination[8] = {
//            0b110100000,
//            0b110100000,
//            0b110100000,
//            0b110100000,
//            0b110100000,
//            0b110100000,
//            0b110100000,
//            0b110100000,
//    };

//
//    const std::map<std::pair<int, int>, int> actionMap = {
//            {{0b000000000, 0b000000000 }, 4},
//            {{0b000000000, 0b000000001 }, 4},
//            {{0b000000000, 0b000000010 }, 4},
//            {{0b000000000, 0b000000100 }, 4},
//            {{0b000000000, 0b000001000 }, 4},
//            {{0b000000000, 0b000010000 }, 2},
//            {{0b000000000, 0b000100000 }, 4},
//            {{0b000000000, 0b001000000 }, 4},
//            {{0b000000000, 0b010000000 }, 4},
//            {{0b000000000, 0b100000000 }, 4},
//            //
//            {{0b100000000, 0b000010000 }, 1},
//            {{0b100000000, 0b010010000 }, 7},
//            {{0b100000000, 0b001010000 }, 6},
//            {{0b100000000, 0b000110000 }, 5},
//            {{0b100000000, 0b000011000 }, 3},
//            {{0b100000000, 0b000010100 }, 3},
//            {{0b100000000, 0b000010010 }, 1},
//            {{0b100000000, 0b000010001 }, 1},
//            //
//            {{0b010000000, 0b000010000 }, 1},
//            {{0b010000000, 0b010010000 }, 7},
//            {{0b010000000, 0b001010000 }, 6},
//            {{0b010000000, 0b000110000 }, 5},
//            {{0b010000000, 0b000011000 }, 3},
//            {{0b010000000, 0b000010100 }, 3},
//            {{0b010000000, 0b000010010 }, 1},
//            {{0b010000000, 0b000010001 }, 1},
//
//    };

    static const std::vector<std::vector<int>> avalAction;

    std::vector<float> initialVector =  {0, 0, 0, 0, 0, 0, 0, 0, 0,
                0, 0, 0, 0, 0, 0, 0, 0, 0};

    bool isLegal(int action);

    int getRandomAction();

    int getSmartAction(bool forWhite);
};


const std::vector<std::vector<int>> TicTacToe::avalAction {
        {0, 1, 2, 3, 4, 5, 6, 7, 8 }, // 0
        {1, 2, 3, 4, 5, 6, 7, 8 }, // 1
        {0, 2, 3, 4, 5, 6, 7, 8 }, // 2
        {2, 3, 4, 5, 6, 7, 8 }, // 3
        {0, 1, 3, 4, 5, 6, 7, 8 }, // 4
        {1, 3, 4, 5, 6, 7, 8 },
        {0, 3, 4, 5, 6, 7, 8 },
        {3, 4, 5, 6, 7, 8 },
        {0, 1, 2, 4, 5, 6, 7, 8 },
        {1, 2, 4, 5, 6, 7, 8 },
        {0, 2, 4, 5, 6, 7, 8 },
        {2, 4, 5, 6, 7, 8 },
        {0, 1, 4, 5, 6, 7, 8 },
        {1, 4, 5, 6, 7, 8 },
        {0, 4, 5, 6, 7, 8 },
        {4, 5, 6, 7, 8 },
        {0, 1, 2, 3, 5, 6, 7, 8 },
        {1, 2, 3, 5, 6, 7, 8 },
        {0, 2, 3, 5, 6, 7, 8 },
        {2, 3, 5, 6, 7, 8 },
        {0, 1, 3, 5, 6, 7, 8 },
        {1, 3, 5, 6, 7, 8 },
        {0, 3, 5, 6, 7, 8 },
        {3, 5, 6, 7, 8 },
        {0, 1, 2, 5, 6, 7, 8 },
        {1, 2, 5, 6, 7, 8 },
        {0, 2, 5, 6, 7, 8 },
        {2, 5, 6, 7, 8 },
        {0, 1, 5, 6, 7, 8 },
        {1, 5, 6, 7, 8 },
        {0, 5, 6, 7, 8 },
        {5, 6, 7, 8 },
        {0, 1, 2, 3, 4, 6, 7, 8 },
        {1, 2, 3, 4, 6, 7, 8 },
        {0, 2, 3, 4, 6, 7, 8 },
        {2, 3, 4, 6, 7, 8 },
        {0, 1, 3, 4, 6, 7, 8 },
        {1, 3, 4, 6, 7, 8 },
        {0, 3, 4, 6, 7, 8 },
        {3, 4, 6, 7, 8 },
        {0, 1, 2, 4, 6, 7, 8 },
        {1, 2, 4, 6, 7, 8 },
        {0, 2, 4, 6, 7, 8 },
        {2, 4, 6, 7, 8 },
        {0, 1, 4, 6, 7, 8 },
        {1, 4, 6, 7, 8 },
        {0, 4, 6, 7, 8 },
        {4, 6, 7, 8 },
        {0, 1, 2, 3, 6, 7, 8 },
        {1, 2, 3, 6, 7, 8 },
        {0, 2, 3, 6, 7, 8 },
        {2, 3, 6, 7, 8 },
        {0, 1, 3, 6, 7, 8 },
        {1, 3, 6, 7, 8 },
        {0, 3, 6, 7, 8 },
        {3, 6, 7, 8 },
        {0, 1, 2, 6, 7, 8 },
        {1, 2, 6, 7, 8 },
        {0, 2, 6, 7, 8 },
        {2, 6, 7, 8 },
        {0, 1, 6, 7, 8 },
        {1, 6, 7, 8 },
        {0, 6, 7, 8 },
        {6, 7, 8 },
        {0, 1, 2, 3, 4, 5, 7, 8 },
        {1, 2, 3, 4, 5, 7, 8 },
        {0, 2, 3, 4, 5, 7, 8 },
        {2, 3, 4, 5, 7, 8 },
        {0, 1, 3, 4, 5, 7, 8 },
        {1, 3, 4, 5, 7, 8 },
        {0, 3, 4, 5, 7, 8 },
        {3, 4, 5, 7, 8 },
        {0, 1, 2, 4, 5, 7, 8 },
        {1, 2, 4, 5, 7, 8 },
        {0, 2, 4, 5, 7, 8 },
        {2, 4, 5, 7, 8 },
        {0, 1, 4, 5, 7, 8 },
        {1, 4, 5, 7, 8 },
        {0, 4, 5, 7, 8 },
        {4, 5, 7, 8 },
        {0, 1, 2, 3, 5, 7, 8 },
        {1, 2, 3, 5, 7, 8 },
        {0, 2, 3, 5, 7, 8 },
        {2, 3, 5, 7, 8 },
        {0, 1, 3, 5, 7, 8 },
        {1, 3, 5, 7, 8 },
        {0, 3, 5, 7, 8 },
        {3, 5, 7, 8 },
        {0, 1, 2, 5, 7, 8 },
        {1, 2, 5, 7, 8 },
        {0, 2, 5, 7, 8 },
        {2, 5, 7, 8 },
        {0, 1, 5, 7, 8 },
        {1, 5, 7, 8 },
        {0, 5, 7, 8 },
        {5, 7, 8 },
        {0, 1, 2, 3, 4, 7, 8 },
        {1, 2, 3, 4, 7, 8 },
        {0, 2, 3, 4, 7, 8 },
        {2, 3, 4, 7, 8 },
        {0, 1, 3, 4, 7, 8 },
        {1, 3, 4, 7, 8 },
        {0, 3, 4, 7, 8 },
        {3, 4, 7, 8 },
        {0, 1, 2, 4, 7, 8 },
        {1, 2, 4, 7, 8 },
        {0, 2, 4, 7, 8 },
        {2, 4, 7, 8 },
        {0, 1, 4, 7, 8 },
        {1, 4, 7, 8 },
        {0, 4, 7, 8 },
        {4, 7, 8 },
        {0, 1, 2, 3, 7, 8 },
        {1, 2, 3, 7, 8 },
        {0, 2, 3, 7, 8 },
        {2, 3, 7, 8 },
        {0, 1, 3, 7, 8 },
        {1, 3, 7, 8 },
        {0, 3, 7, 8 },
        {3, 7, 8 },
        {0, 1, 2, 7, 8 },
        {1, 2, 7, 8 },
        {0, 2, 7, 8 },
        {2, 7, 8 },
        {0, 1, 7, 8 },
        {1, 7, 8 },
        {0, 7, 8 },
        {7, 8 },
        {0, 1, 2, 3, 4, 5, 6, 8 },
        {1, 2, 3, 4, 5, 6, 8 },
        {0, 2, 3, 4, 5, 6, 8 },
        {2, 3, 4, 5, 6, 8 },
        {0, 1, 3, 4, 5, 6, 8 },
        {1, 3, 4, 5, 6, 8 },
        {0, 3, 4, 5, 6, 8 },
        {3, 4, 5, 6, 8 },
        {0, 1, 2, 4, 5, 6, 8 },
        {1, 2, 4, 5, 6, 8 },
        {0, 2, 4, 5, 6, 8 },
        {2, 4, 5, 6, 8 },
        {0, 1, 4, 5, 6, 8 },
        {1, 4, 5, 6, 8 },
        {0, 4, 5, 6, 8 },
        {4, 5, 6, 8 },
        {0, 1, 2, 3, 5, 6, 8 },
        {1, 2, 3, 5, 6, 8 },
        {0, 2, 3, 5, 6, 8 },
        {2, 3, 5, 6, 8 },
        {0, 1, 3, 5, 6, 8 },
        {1, 3, 5, 6, 8 },
        {0, 3, 5, 6, 8 },
        {3, 5, 6, 8 },
        {0, 1, 2, 5, 6, 8 },
        {1, 2, 5, 6, 8 },
        {0, 2, 5, 6, 8 },
        {2, 5, 6, 8 },
        {0, 1, 5, 6, 8 },
        {1, 5, 6, 8 },
        {0, 5, 6, 8 },
        {5, 6, 8 },
        {0, 1, 2, 3, 4, 6, 8 },
        {1, 2, 3, 4, 6, 8 },
        {0, 2, 3, 4, 6, 8 },
        {2, 3, 4, 6, 8 },
        {0, 1, 3, 4, 6, 8 },
        {1, 3, 4, 6, 8 },
        {0, 3, 4, 6, 8 },
        {3, 4, 6, 8 },
        {0, 1, 2, 4, 6, 8 },
        {1, 2, 4, 6, 8 },
        {0, 2, 4, 6, 8 },
        {2, 4, 6, 8 },
        {0, 1, 4, 6, 8 },
        {1, 4, 6, 8 },
        {0, 4, 6, 8 },
        {4, 6, 8 },
        {0, 1, 2, 3, 6, 8 },
        {1, 2, 3, 6, 8 },
        {0, 2, 3, 6, 8 },
        {2, 3, 6, 8 },
        {0, 1, 3, 6, 8 },
        {1, 3, 6, 8 },
        {0, 3, 6, 8 },
        {3, 6, 8 },
        {0, 1, 2, 6, 8 },
        {1, 2, 6, 8 },
        {0, 2, 6, 8 },
        {2, 6, 8 },
        {0, 1, 6, 8 },
        {1, 6, 8 },
        {0, 6, 8 },
        {6, 8 },
        {0, 1, 2, 3, 4, 5, 8 },
        {1, 2, 3, 4, 5, 8 },
        {0, 2, 3, 4, 5, 8 },
        {2, 3, 4, 5, 8 },
        {0, 1, 3, 4, 5, 8 },
        {1, 3, 4, 5, 8 },
        {0, 3, 4, 5, 8 },
        {3, 4, 5, 8 },
        {0, 1, 2, 4, 5, 8 },
        {1, 2, 4, 5, 8 },
        {0, 2, 4, 5, 8 },
        {2, 4, 5, 8 },
        {0, 1, 4, 5, 8 },
        {1, 4, 5, 8 },
        {0, 4, 5, 8 },
        {4, 5, 8 },
        {0, 1, 2, 3, 5, 8 },
        {1, 2, 3, 5, 8 },
        {0, 2, 3, 5, 8 },
        {2, 3, 5, 8 },
        {0, 1, 3, 5, 8 },
        {1, 3, 5, 8 },
        {0, 3, 5, 8 },
        {3, 5, 8 },
        {0, 1, 2, 5, 8 },
        {1, 2, 5, 8 },
        {0, 2, 5, 8 },
        {2, 5, 8 },
        {0, 1, 5, 8 },
        {1, 5, 8 },
        {0, 5, 8 },
        {5, 8 },
        {0, 1, 2, 3, 4, 8 },
        {1, 2, 3, 4, 8 },
        {0, 2, 3, 4, 8 },
        {2, 3, 4, 8 },
        {0, 1, 3, 4, 8 },
        {1, 3, 4, 8 },
        {0, 3, 4, 8 },
        {3, 4, 8 },
        {0, 1, 2, 4, 8 },
        {1, 2, 4, 8 },
        {0, 2, 4, 8 },
        {2, 4, 8 },
        {0, 1, 4, 8 },
        {1, 4, 8 },
        {0, 4, 8 },
        {4, 8 },
        {0, 1, 2, 3, 8 },
        {1, 2, 3, 8 },
        {0, 2, 3, 8 },
        {2, 3, 8 },
        {0, 1, 3, 8 },
        {1, 3, 8 },
        {0, 3, 8 },
        {3, 8 },
        {0, 1, 2, 8 },
        {1, 2, 8 },
        {0, 2, 8 },
        {2, 8 },
        {0, 1, 8 },
        {1, 8 },
        {0, 8 },
        {8 },
        {0, 1, 2, 3, 4, 5, 6, 7 }
};

#endif //MASTER_TICTACTOE_H
